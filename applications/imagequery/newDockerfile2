FROM tensorflow/tensorflow:1.12.0-gpu-py3 
# Python 3.5.2
RUN apt-get update
RUN pip install numpy
RUN pip install nltk 
RUN python -m nltk.downloader all

ADD imagequery/2_newImageCaptionGenerator/im2txt /container/workspace/im2txt
ADD imagequery/2_newImageCaptionGenerator/captionData /container/workspace/captionData/
ADD imagequery/2_newImageCaptionGenerator/app /container/

RUN chmod 777 /container/workspace/im2txt/model/downloadModels.sh
RUN /container/workspace/im2txt/model/downloadModels.sh
RUN mv /notebooks/newmodel.ckpt-2000000.meta /container/workspace/im2txt/model
RUN mv /notebooks/newmodel.ckpt-2000000.data-00000-of-00001 /container/workspace/im2txt/model

RUN chmod 777 /container/workspace/im2txt/runWithArg.sh
RUN /container/workspace/im2txt/runWithArg.sh

CMD ["python","/container/predict.py"]

EXPOSE 9000
