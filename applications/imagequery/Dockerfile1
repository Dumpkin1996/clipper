FROM ubuntu:bionic
RUN apt-get update
RUN apt-get install wget zip unzip python3 python3-pip -y
RUN pip3 install SpeechRecognition
RUN pip3 install grpcio
RUN pip3 install protobuf

# container/ will have predict.py, data/
ADD imagequery/c1_speechRecognition/app /container/
ADD imagequery/c1_speechRecognition/data /container/data

# dataset1 
# dataset source: http://festvox.org/cmu_arctic/
# RUN wget --progress=bar:force http://festvox.org/cmu_arctic/cmu_arctic/packed/cmu_us_awb_arctic-0.95-release.zip
# RUN mv /cmu_us_awb_arctic-0.95-release.zip /container/data/dataset1
# RUN chmod 777 /container/data/dataset1/unzip.sh
# RUN /container/data/dataset1/unzip.sh

# dataset2
RUN wget --progress=bar:force https://groups.csail.mit.edu/sls/downloads/flickraudio/downloads/flickr_audio.tar.gz
RUN find / -name flickr_audio.tar.gz
RUN mv $(find / -name flickr_audio.tar.gz) /container/data/dataset2
RUN chmod 777 /container/data/dataset2/untarRename.sh 
RUN /container/data/dataset2/untarRename.sh

# dataset3
RUN wget --progress=bar:force https://www.kaggle.com/rtatman/speech-accent-archive/downloads/speech-accent-archive.zip/2
RUN mv /notebooks/speech-accent-archive.zip /container/data/dataset3
RUN unzip /container/data/dataset3/speech-accent-archive.zip -d /container/data/dataset3
RUN unzip /container/data/dataset3/speech-accent-archive/recordings.zip -d /container/data/dataset3/speech-accent-archive/
RUN chmod 777 /container/data/dataset3/rename.sh
RUN /container/im2txt/data/dataset3/rename.sh

ADD grpc/app/container_entry.sh /container/
ADD grpc/app/server.py /container/
ADD grpc/app/model_pb2_grpc.py /container/
ADD grpc/app/model_pb2.py /container/
ADD grpc/app/proxy_pb2_grpc.py /container/
ADD grpc/app/proxy_pb2.py /container/

CMD ["/container/container_entry.sh", "c1", "/container/server.py"]

EXPOSE 8000